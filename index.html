<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ ì£¼ì‹ ì‹¤ì‹œê°„ ë°ì´í„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.0.0/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-6xl mx-auto">
        <!-- í—¤ë” -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-2xl font-bold text-center mb-4">ğŸ‡°ğŸ‡· í•œêµ­ ì£¼ì‹ ì‹¤ì‹œê°„ ë°ì´í„°</h1>
            
            <!-- ê²€ìƒ‰ ì˜ì—­ -->
            <div class="flex gap-4 max-w-2xl mx-auto mb-4">
                <input 
                    id="stockCode" 
                    type="text" 
                    placeholder="ì¢…ëª©ì½”ë“œ ì…ë ¥ (ì˜ˆ: 005930)"
                    class="flex-1 px-4 py-2 border rounded-lg"
                    value="005930"
                >
                <button 
                    onclick="searchStock()" 
                    class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                >
                    ê²€ìƒ‰
                </button>
            </div>
            
            <!-- ì¸ê¸° ì¢…ëª© ë²„íŠ¼ -->
            <div class="flex justify-center gap-2">
                <button onclick="quickSearch('005930')" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded">ì‚¼ì„±ì „ì</button>
                <button onclick="quickSearch('000660')" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded">SKí•˜ì´ë‹‰ìŠ¤</button>
                <button onclick="quickSearch('035420')" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded">NAVER</button>
                <button onclick="quickSearch('035720')" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded">ì¹´ì¹´ì˜¤</button>
            </div>
        </div>

        <!-- ë¡œë”© í‘œì‹œ -->
        <div id="loading" class="hidden bg-white rounded-lg p-8 text-center">
            <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <!-- ì£¼ì‹ ì •ë³´ í‘œì‹œ ì˜ì—­ -->
        <div id="stockInfo" class="hidden bg-white rounded-lg shadow-lg p-6">
            <h2 id="stockName" class="text-xl font-bold mb-4"></h2>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-blue-50 p-4 rounded">
                    <p class="text-sm text-gray-600">í˜„ì¬ê°€</p>
                    <p id="currentPrice" class="text-xl font-bold"></p>
                </div>
                <div class="bg-green-50 p-4 rounded">
                    <p class="text-sm text-gray-600">ì „ì¼ëŒ€ë¹„</p>
                    <p id="priceChange" class="text-xl font-bold"></p>
                </div>
                <div class="bg-purple-50 p-4 rounded">
                    <p class="text-sm text-gray-600">ê±°ë˜ëŸ‰</p>
                    <p id="volume" class="text-xl font-bold"></p>
                </div>
                <div class="bg-orange-50 p-4 rounded">
                    <p class="text-sm text-gray-600">ê±°ë˜ëŒ€ê¸ˆ</p>
                    <p id="tradingValue" class="text-xl font-bold"></p>
                </div>
            </div>

            <!-- ì°¨íŠ¸ ì˜ì—­ -->
            <div id="chartContainer" style="height: 400px;" class="bg-gray-50 rounded p-4"></div>
        </div>
    </div>

    <script>
        // API ê¸°ë³¸ URL (Vercel ë°°í¬ í›„ ìë™ ì„¤ì •)
        const API_BASE = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000/api' 
            : '/api';

        let chart = null;

        // ë¹ ë¥¸ ê²€ìƒ‰
        function quickSearch(code) {
            document.getElementById('stockCode').value = code;
            searchStock();
        }

        // ì£¼ì‹ ê²€ìƒ‰
        async function searchStock() {
            const stockCode = document.getElementById('stockCode').value;
            if (!stockCode) {
                alert('ì¢…ëª©ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }

            // ë¡œë”© í‘œì‹œ
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('stockInfo').classList.add('hidden');

            try {
                // Yahoo Finance API í˜¸ì¶œ (í•œêµ­ ì£¼ì‹)
                const response = await fetch(`${API_BASE}/stock?code=${stockCode}`);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                // ë°ì´í„° í‘œì‹œ
                displayStockData(data);
            } catch (error) {
                console.error('Error:', error);
                alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // ì£¼ì‹ ë°ì´í„° í‘œì‹œ
        function displayStockData(data) {
            document.getElementById('stockInfo').classList.remove('hidden');
            
            // ê¸°ë³¸ ì •ë³´
            document.getElementById('stockName').textContent = `${data.name} (${data.symbol})`;
            document.getElementById('currentPrice').textContent = `â‚©${data.price.toLocaleString()}`;
            
            // ë³€ë™ë¥  ìƒ‰ìƒ
            const changeColor = data.change >= 0 ? 'text-red-600' : 'text-blue-600';
            const arrow = data.change >= 0 ? 'â–²' : 'â–¼';
            document.getElementById('priceChange').innerHTML = 
                `<span class="${changeColor}">${arrow} ${Math.abs(data.change).toLocaleString()} (${data.changePercent}%)</span>`;
            
            document.getElementById('volume').textContent = data.volume.toLocaleString();
            document.getElementById('tradingValue').textContent = `${(data.tradingValue / 100000000).toFixed(0)}ì–µ`;

            // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            drawChart(data.chartData);
        }

        // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawChart(chartData) {
            const container = document.getElementById('chartContainer');
            
            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
            if (chart) {
                chart.remove();
                chart = null;
            }

            // ìƒˆ ì°¨íŠ¸ ìƒì„±
            chart = LightweightCharts.createChart(container, {
                width: container.clientWidth,
                height: 380,
                layout: {
                    backgroundColor: '#f9fafb',
                    textColor: '#333',
                },
                grid: {
                    vertLines: { color: '#e5e7eb' },
                    horzLines: { color: '#e5e7eb' },
                }
            });

            // ìº”ë“¤ìŠ¤í‹± ì‹œë¦¬ì¦ˆ ì¶”ê°€
            const candlestickSeries = chart.addCandlestickSeries({
                upColor: '#ef4444',      // ìƒìŠ¹: ë¹¨ê°•
                downColor: '#3b82f6',    // í•˜ë½: íŒŒë‘
                borderUpColor: '#ef4444',
                borderDownColor: '#3b82f6',
                wickUpColor: '#ef4444',
                wickDownColor: '#3b82f6',
            });

            // ë°ì´í„° ì„¤ì •
            candlestickSeries.setData(chartData);
            chart.timeScale().fitContent();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ê²€ìƒ‰
        window.addEventListener('DOMContentLoaded', () => {
            searchStock();
        });
    </script>
</body>
</html>
